{"ast":null,"code":"import _asyncToGenerator from\"C:/laragon/www/StellarLikes/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/laragon/www/StellarLikes/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\laragon\\\\www\\\\StellarLikes\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";// CouponButton.jsx\nimport React,{useState}from'react';import css from'./CouponButton.module.css';import{jsx as _jsx}from\"react/jsx-runtime\";var CouponButton=function CouponButton(_ref){var couponCode=_ref.couponCode,price=_ref.price,quantity=_ref.quantity,setCouponError=_ref.setCouponError,handleCouponApplied=_ref.handleCouponApplied,fetchCoupons=_ref.fetchCoupons;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var applyCoupon=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response,matchedCoupon,currentDate,expiryDate,discountAmount,couponAmount;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;setLoading(true);setCouponError(null);_context.next=5;return fetchCoupons();case 5:response=_context.sent;// Вызываем переданную функцию\nconsole.log(response);matchedCoupon=response.find(function(coupon){return coupon.code.toLowerCase()===couponCode.toLowerCase();});if(matchedCoupon){_context.next=11;break;}setCouponError('Coupon code not found.');return _context.abrupt(\"return\");case 11:if(!matchedCoupon.date_expires){_context.next=17;break;}currentDate=new Date();expiryDate=new Date(matchedCoupon.date_expires);if(!(currentDate>expiryDate)){_context.next=17;break;}setCouponError('Coupon has expired.');return _context.abrupt(\"return\");case 17:if(!(matchedCoupon.usage_limit!==null&&matchedCoupon.usage_count>=matchedCoupon.usage_limit)){_context.next=20;break;}setCouponError('Coupon usage limit has been reached.');return _context.abrupt(\"return\");case 20:discountAmount=0;couponAmount=parseFloat(matchedCoupon.amount)||0;_context.t0=matchedCoupon.discount_type;_context.next=_context.t0==='percent'?25:_context.t0==='fixed_cart'?27:_context.t0==='fixed_product'?29:31;break;case 25:discountAmount=price*(couponAmount/100);return _context.abrupt(\"break\",33);case 27:discountAmount=couponAmount;return _context.abrupt(\"break\",33);case 29:discountAmount=couponAmount*quantity;return _context.abrupt(\"break\",33);case 31:setCouponError('Unsupported coupon type.');return _context.abrupt(\"return\");case 33:discountAmount=Math.min(discountAmount,price);handleCouponApplied(discountAmount,matchedCoupon.code);_context.next=41;break;case 37:_context.prev=37;_context.t1=_context[\"catch\"](0);console.error('Error fetching coupons:',_context.t1);setCouponError('An error occurred while applying the coupon.');case 41:_context.prev=41;setLoading(false);return _context.finish(41);case 44:case\"end\":return _context.stop();}}},_callee,null,[[0,37,41,44]]);}));return function applyCoupon(){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsx(\"button\",{className:css.couponSbmt,type:\"button\",onClick:applyCoupon,disabled:loading||!couponCode,children:loading?'Loading...':'Apply'});};export default CouponButton;","map":{"version":3,"names":["React","useState","css","jsx","_jsx","CouponButton","_ref","couponCode","price","quantity","setCouponError","handleCouponApplied","fetchCoupons","_useState","_useState2","_slicedToArray","loading","setLoading","applyCoupon","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","response","matchedCoupon","currentDate","expiryDate","discountAmount","couponAmount","wrap","_callee$","_context","prev","next","sent","console","log","find","coupon","code","toLowerCase","abrupt","date_expires","Date","usage_limit","usage_count","parseFloat","amount","t0","discount_type","Math","min","t1","error","finish","stop","apply","arguments","className","couponSbmt","type","onClick","disabled","children"],"sources":["C:/laragon/www/StellarLikes/src/components/CouponButton/CouponButton.jsx"],"sourcesContent":["// CouponButton.jsx\r\nimport React, { useState } from 'react';\r\nimport css from './CouponButton.module.css';\r\n\r\nconst CouponButton = ({\r\n  couponCode,\r\n  price,\r\n  quantity,\r\n  setCouponError,\r\n  handleCouponApplied,\r\n  fetchCoupons,\r\n}) => {\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const applyCoupon = async () => {\r\n    try {\r\n      setLoading(true);\r\n      setCouponError(null);\r\n\r\n      const response = await fetchCoupons(); // Вызываем переданную функцию\r\n\r\n      console.log(response);\r\n\r\n      const matchedCoupon = response.find(\r\n        coupon => coupon.code.toLowerCase() === couponCode.toLowerCase()\r\n      );\r\n\r\n      if (!matchedCoupon) {\r\n        setCouponError('Coupon code not found.');\r\n        return;\r\n      }\r\n\r\n      if (matchedCoupon.date_expires) {\r\n        const currentDate = new Date();\r\n        const expiryDate = new Date(matchedCoupon.date_expires);\r\n        if (currentDate > expiryDate) {\r\n          setCouponError('Coupon has expired.');\r\n          return;\r\n        }\r\n      }\r\n\r\n      if (\r\n        matchedCoupon.usage_limit !== null &&\r\n        matchedCoupon.usage_count >= matchedCoupon.usage_limit\r\n      ) {\r\n        setCouponError('Coupon usage limit has been reached.');\r\n        return;\r\n      }\r\n\r\n      let discountAmount = 0;\r\n      const couponAmount = parseFloat(matchedCoupon.amount) || 0;\r\n\r\n      switch (matchedCoupon.discount_type) {\r\n        case 'percent':\r\n          discountAmount = price * (couponAmount / 100);\r\n          break;\r\n        case 'fixed_cart':\r\n          discountAmount = couponAmount;\r\n          break;\r\n        case 'fixed_product':\r\n          discountAmount = couponAmount * quantity;\r\n          break;\r\n        default:\r\n          setCouponError('Unsupported coupon type.');\r\n          return;\r\n      }\r\n\r\n      discountAmount = Math.min(discountAmount, price);\r\n\r\n      handleCouponApplied(discountAmount, matchedCoupon.code);\r\n    } catch (error) {\r\n      console.error('Error fetching coupons:', error);\r\n      setCouponError('An error occurred while applying the coupon.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <button\r\n      className={css.couponSbmt}\r\n      type=\"button\"\r\n      onClick={applyCoupon}\r\n      disabled={loading || !couponCode}\r\n    >\r\n      {loading ? 'Loading...' : 'Apply'}\r\n    </button>\r\n  );\r\n};\r\n\r\nexport default CouponButton;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}