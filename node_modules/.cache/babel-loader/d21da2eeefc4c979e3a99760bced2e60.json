{"ast":null,"code":"import _asyncToGenerator from\"D:/StellarLikes/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"D:/StellarLikes/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"D:\\\\StellarLikes\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";// CouponButton.jsx\nimport React,{useState}from'react';import axios from'axios';import css from'./CouponButton.module.css';// Ensure you store your consumer keys securely\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var consumer_key=process.env.REACT_APP_TEST_CHECKOUT_CONSUMER_KEY;var consumer_secret=process.env.REACT_APP_TEST_CHECKOUT_CONSUMER_SECRET_KEY;var CouponButton=function CouponButton(_ref){var couponCode=_ref.couponCode,price=_ref.price,quantity=_ref.quantity,setCouponError=_ref.setCouponError,handleCouponApplied=_ref.handleCouponApplied;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var FetchAllCoupons=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response,coupons,matchedCoupon,currentDate,expiryDate,discountAmount,couponAmount;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;setLoading(true);setCouponError(null);_context.next=5;return axios.get(\"https://testgraming.net/wp-json/wc/v3/coupons?consumer_key=\".concat(consumer_key,\"&consumer_secret=\").concat(consumer_secret));case 5:response=_context.sent;coupons=response.data;matchedCoupon=coupons.find(function(coupon){return coupon.code.toLowerCase()===couponCode.toLowerCase();});if(matchedCoupon){_context.next=11;break;}setCouponError('Coupon code not found.');return _context.abrupt(\"return\");case 11:if(!matchedCoupon.date_expires){_context.next=17;break;}currentDate=new Date();expiryDate=new Date(matchedCoupon.date_expires);if(!(currentDate>expiryDate)){_context.next=17;break;}setCouponError('Coupon has expired.');return _context.abrupt(\"return\");case 17:if(!(matchedCoupon.usage_limit!==null&&matchedCoupon.usage_count>=matchedCoupon.usage_limit)){_context.next=20;break;}setCouponError('Coupon usage limit has been reached.');return _context.abrupt(\"return\");case 20:discountAmount=0;couponAmount=parseFloat(matchedCoupon.amount)||0;if(!(matchedCoupon.discount_type==='percent')){_context.next=26;break;}discountAmount=price*(couponAmount/100);_context.next=36;break;case 26:if(!(matchedCoupon.discount_type==='fixed_cart')){_context.next=30;break;}discountAmount=couponAmount;_context.next=36;break;case 30:if(!(matchedCoupon.discount_type==='fixed_product')){_context.next=34;break;}discountAmount=couponAmount*quantity;_context.next=36;break;case 34:setCouponError('Unsupported coupon type.');return _context.abrupt(\"return\");case 36:discountAmount=Math.min(discountAmount,price);handleCouponApplied(discountAmount,matchedCoupon.code);_context.next=44;break;case 40:_context.prev=40;_context.t0=_context[\"catch\"](0);console.error('Error fetching coupons:',_context.t0);setCouponError('An error occurred while applying the coupon.');case 44:_context.prev=44;setLoading(false);return _context.finish(44);case 47:case\"end\":return _context.stop();}}},_callee,null,[[0,40,44,47]]);}));return function FetchAllCoupons(){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"button\",{className:css.couponSbmt,type:\"button\",onClick:FetchAllCoupons,disabled:loading||!couponCode,children:loading?'Loading...':'Apply'})});};export default CouponButton;","map":{"version":3,"names":["React","useState","axios","css","jsx","_jsx","Fragment","_Fragment","consumer_key","process","env","REACT_APP_TEST_CHECKOUT_CONSUMER_KEY","consumer_secret","REACT_APP_TEST_CHECKOUT_CONSUMER_SECRET_KEY","CouponButton","_ref","couponCode","price","quantity","setCouponError","handleCouponApplied","_useState","_useState2","_slicedToArray","loading","setLoading","FetchAllCoupons","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","response","coupons","matchedCoupon","currentDate","expiryDate","discountAmount","couponAmount","wrap","_callee$","_context","prev","next","get","concat","sent","data","find","coupon","code","toLowerCase","abrupt","date_expires","Date","usage_limit","usage_count","parseFloat","amount","discount_type","Math","min","t0","console","error","finish","stop","apply","arguments","children","className","couponSbmt","type","onClick","disabled"],"sources":["D:/StellarLikes/src/components/CouponButton/CouponButton.jsx"],"sourcesContent":["// CouponButton.jsx\r\nimport React, { useState } from 'react';\r\nimport axios from 'axios';\r\nimport css from './CouponButton.module.css';\r\n\r\n// Ensure you store your consumer keys securely\r\nconst consumer_key = process.env.REACT_APP_TEST_CHECKOUT_CONSUMER_KEY;\r\nconst consumer_secret = process.env.REACT_APP_TEST_CHECKOUT_CONSUMER_SECRET_KEY;\r\n\r\nconst CouponButton = ({\r\n  couponCode,\r\n  price,\r\n  quantity,\r\n  setCouponError,\r\n  handleCouponApplied,\r\n}) => {\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const FetchAllCoupons = async () => {\r\n    try {\r\n      setLoading(true);\r\n      setCouponError(null);\r\n      const response = await axios.get(\r\n        `https://testgraming.net/wp-json/wc/v3/coupons?consumer_key=${consumer_key}&consumer_secret=${consumer_secret}`\r\n      );\r\n      const coupons = response.data;\r\n\r\n      const matchedCoupon = coupons.find(\r\n        coupon => coupon.code.toLowerCase() === couponCode.toLowerCase()\r\n      );\r\n\r\n      if (!matchedCoupon) {\r\n        setCouponError('Coupon code not found.');\r\n        return;\r\n      }\r\n\r\n      if (matchedCoupon.date_expires) {\r\n        const currentDate = new Date();\r\n        const expiryDate = new Date(matchedCoupon.date_expires);\r\n        if (currentDate > expiryDate) {\r\n          setCouponError('Coupon has expired.');\r\n          return;\r\n        }\r\n      }\r\n\r\n      if (\r\n        matchedCoupon.usage_limit !== null &&\r\n        matchedCoupon.usage_count >= matchedCoupon.usage_limit\r\n      ) {\r\n        setCouponError('Coupon usage limit has been reached.');\r\n        return;\r\n      }\r\n\r\n      let discountAmount = 0;\r\n      const couponAmount = parseFloat(matchedCoupon.amount) || 0;\r\n\r\n      if (matchedCoupon.discount_type === 'percent') {\r\n        discountAmount = price * (couponAmount / 100);\r\n      } else if (matchedCoupon.discount_type === 'fixed_cart') {\r\n        discountAmount = couponAmount;\r\n      } else if (matchedCoupon.discount_type === 'fixed_product') {\r\n        discountAmount = couponAmount * quantity;\r\n      } else {\r\n        setCouponError('Unsupported coupon type.');\r\n        return;\r\n      }\r\n\r\n      discountAmount = Math.min(discountAmount, price);\r\n\r\n      handleCouponApplied(discountAmount, matchedCoupon.code);\r\n    } catch (error) {\r\n      console.error('Error fetching coupons:', error);\r\n      setCouponError('An error occurred while applying the coupon.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <button\r\n        className={css.couponSbmt}\r\n        type=\"button\"\r\n        onClick={FetchAllCoupons}\r\n        disabled={loading || !couponCode}\r\n      >\r\n        {loading ? 'Loading...' : 'Apply'}\r\n      </button>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default CouponButton;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}